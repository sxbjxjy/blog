{% comment %}
<!-- below is limited only in the case with all posts having a pair of (parent and child) categories -->
{% endcomment %}
<article>
    <!-- 解説1 -->
    {% capture posts_name %}
    {% assign my_posts = site.posts | group_by: 'categories' %}
    {% for my_post in my_posts %}
    {% assign post_name = my_post.name | remove: "[" | remove: "]" | remove: '"' %}
    {{ post_name }}
    <a href="{{ my_ post.url | relative_url }}">
        {{ my_post.title | escape }}
    </a>
    <!-- {% unless forloop.last %}|{% endunless %} -->
    {% endfor %}
    {% endcapture %}
    {% assign integrated_categories_names = posts_name | split: "|" | sort %}
    {% assign finished_categories = "nil, nil" | split: ", " %} <!-- 解説2 -->

    <ul class="taxonomy__index"> <!-- 解説3 -->
        {% for integrated_categories_name in integrated_categories_names %}
        {% assign pair_categories = integrated_categories_name | split: ", " %}
        {% unless finished_categories contains pair_categories[0] %}
        {% unless forloop.first %}
        </li>
        {% endunless %}
        <li>
            {% for category in site.categories %} <!-- 解説4 -->
            {% if pair_categories[0] == category[0] %}
            <a href="#{{ category[0] | slugify }}">
                <strong>{{ category[0] }}</strong> <span class="taxonomy__count">{{ category[1].size }}</span>
            </a>
            {% break %}
            {% endif %}
            {% endfor %}
            {% assign finished_categories = finished_categories | concat: pair_categories %}
            {% endunless %}
            <ul class="taxonomy__subindex">
                <li>
                    {% for category in site.categories %}
                    {% if pair_categories[1] == category[0] %}
                    <a href="#{{ category[0] | slugify }}">
                        <strong>{{ category[0] }}</strong> <span class="taxonomy__count">{{ category[1].size
                            }}</span>
                    </a>
                    {% break %}
                    {% endif %}
                    {% endfor %}
                </li>
            </ul>
            {% endfor %}
    </ul>

</article>